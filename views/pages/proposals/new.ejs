<%- include("../../partials/head.ejs") %>

    <body id="page-top">
        <div id="wrapper">
            <%- include("../../partials/sidebar.ejs") %>
                <div id="content-wrapper" class="d-flex flex-column">
                    <div id="content">
                        <%- include("../../partials/topbar.ejs") %>
                            <div class="container-fluid">
                                <h1 class="h3 mb-2 text-gray-800">Nova proposta</h1>

                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Insira os dados</h6>
                                    </div>

                                    <div class="card-body">
                                        <form method="POST" id="proposalForm">
                                            <b class="mb-4">Selecione o cliente</b>
                                            <div class="mb-3">
                                                <select class="form-control" name='customerID' id="customerID" required>
                                                    <option selected value="Geral">Nenhum selecionado (Se mantido como
                                                        nenhum, aparecerá na proposta como "Geral")</option>
                                                    <% customers.forEach(c=> { %>
                                                        <option value="<%=c.key%>">
                                                            <%=c.data.nomeComp || c.data.nomeFantasia%> - (<%=c.data.cpf
                                                                    || c.data.cnpj%>)
                                                        </option>
                                                        <% }) %>
                                                </select>
                                            </div>

                                            <b class="mb-4">Nome do Vendedor</b>
                                            <div class="mb-3">
                                                <input name="nomeVendedor" class="form-control" id="nomeVendedor"
                                                    type="text" value="">
                                            </div>

                                            <hr>

                                            <h6><b>Geral</b></h6>

                                            <div class="row gx-3 mb-3">
                                                <!-- Form Group (first name)-->
                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="proposalID">Identificação da
                                                        Proposta</label>
                                                    <input name="proposalID" class="form-control" id="proposalID"
                                                        type="text" value="<%=identifyNumber%>">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="classe">Classe</label>
                                                    <select class="form-control" name='classe' id="classe" required>
                                                        <option selected>Monofásico</option>
                                                        <option>Bifásico</option>
                                                        <option>Trifásico</option>
                                                    </select>

                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="prazo">
                                                        Prazo de Entrega (dias)
                                                    </label>
                                                    <input name="prazo" class="form-control" id="prazo" type="numer"
                                                        placeholder="90" value="90">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="validade">
                                                        Validade da Proposta (dias)
                                                    </label>
                                                    <input name="validade" class="form-control" id="validade"
                                                        type="number" value="5">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="invQntd">
                                                        Quantidade de Inversores
                                                    </label>
                                                    <input name="invQntd" class="form-control" id="invQntd"
                                                        type="number" value="1">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="placasQntd">
                                                        Quantidade de Placas
                                                    </label>
                                                    <input name="placasQntd" class="form-control" id="placasQntd"
                                                        type="number" value="1">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="kwp">
                                                        kWp do sistema
                                                    </label>
                                                    <input name="kwp" class="form-control" id="kwp" type="number"
                                                        value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="kwMes">
                                                        Produção mensal (kwh)
                                                    </label>
                                                    <input name="kwMes" class="form-control" id="kwMes" type="number"
                                                        value="0">
                                                </div>
                                            </div>

                                            <hr>

                                            <h6><b>Detalhes do Sistema</b></h6>

                                            <div class="row gx-3 mb-3">
                                                <div class="col-md-6">
                                                    <label class="small mb-1" for="tituloGerador">
                                                        Título do gerador
                                                    </label>
                                                    <input name="tituloGerador" class="form-control" id="tituloGerador"
                                                        type="text" placeholder="GERADOR DE ENERGIA SOLAR...">
                                                </div>

                                                <div class="col-md-6">
                                                    <label class="small mb-1" for="descricaoGerador">
                                                        Descrição do gerador
                                                    </label>
                                                    <input name="descricaoGerador" class="form-control"
                                                        id="descricaoGerador" type="text"
                                                        placeholder="COMPONENTES DO GERADOR: ...">
                                                </div>

                                            </div>
                                            <hr>

                                            <h6><b>Pagamento</b></h6>

                                            <div class="row gx-3 mb-3">
                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="valorSistema">
                                                        Valor Total
                                                    </label>
                                                    <input name="valorSistema" class="form-control" id="valorSistema"
                                                        type="text" value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="entrada">
                                                        Valor de Entrada
                                                    </label>
                                                    <input name="entrada" class="form-control" id="entrada" type="text"
                                                        value="0">
                                                </div>


                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="formaPag">Método de Pagamento</label>
                                                    <select class="form-control" name='formaPag' id="formaPag" required>
                                                        <option selected>Financiamento</option>
                                                        <option>Cartão</option>
                                                        <option>Pix</option>
                                                        <option>Boleto</option>
                                                        <option>Transferência</option>
                                                        <option>Outro</option>
                                                    </select>

                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="valorFinanciado">
                                                        Valor Financiado
                                                    </label>
                                                    <input name="valorFinanciado" class="form-control"
                                                        id="valorFinanciado" type="text" value="0">
                                                </div>



                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="valorParceladoCartao">
                                                        Valor Parcelado no Cartão
                                                    </label>
                                                    <input name="valorParceladoCartao" class="form-control"
                                                        id="valorParceladoCartao" type="text" value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="banco">
                                                        Banco
                                                    </label>
                                                    <input name="banco" class="form-control" id="banco" type="text"
                                                        value="Financiamento">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="24x">
                                                        24x
                                                    </label>
                                                    <input name="24x" class="form-control" id="24x" type="text"
                                                        value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="36x">
                                                        36x
                                                    </label>
                                                    <input name="36x" class="form-control" id="36x" type="text"
                                                        value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="48x">
                                                        48x
                                                    </label>
                                                    <input name="48x" class="form-control" id="48x" type="text"
                                                        value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="60x">
                                                        60x
                                                    </label>
                                                    <input name="60x" class="form-control" id="60x" type="text"
                                                        value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="72x">
                                                        72x
                                                    </label>
                                                    <input name="72x" class="form-control" id="72x" type="text"
                                                        value="0">
                                                </div>

                                                <div class="col-md-2">
                                                    <label class="small mb-1" for="84x">
                                                        84x
                                                    </label>
                                                    <input name="84x" class="form-control" id="84x" type="text"
                                                        value="0">
                                                </div>

                                            </div>

                                            <hr>

                                            <input name="type" type="text" value="saveAndGenerate" style="display: none"
                                                placeholder="alterar o valor do input pode ocorrer erros, se for detectada alteração, sua conta será banida.">

                                            <a href="#" target="_blank" class="btn btn-secondary btn-icon-split">
                                                <span class="icon text-white-50">
                                                    <i class="fas fa-exclamation"></i>
                                                </span>
                                                <span class="text">Documentação da Proposta</span>
                                            </a>

                                            <button id="saveAndGenerateButton"
                                                class="btn btn-success btn-icon-split"><span class="icon text-white-50">
                                                    <i class="fas fa-check"></i>
                                                </span>
                                                <span class="text">Salvar e Gerar Proposta</span>
                                            </button>

                                        </form>
                                    </div>

                                </div>


                            </div>
                    </div>
                    <%- include("../../partials/footer.ejs") %>
                </div>
        </div>
        <a class="scroll-to-top rounded" href="#page-top">
            <i class="fas fa-angle-up"></i>
        </a>
        <%- include("../components/modal/logout.ejs") %>
            <script src="/vendor/jquery/jquery.min.js"></script>
            <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
            <script src="/vendor/jquery-easing/jquery.easing.min.js"></script>
            <script src="/js/sb-admin-2.min.js"></script>

            <script>
                const proposalForm = document.getElementById('proposalForm');

                document.getElementById("saveAndGenerateButton").addEventListener('click', function (event) {
                    proposalForm.submit();
                    swal("Salvando & Gerando", "Não saia dessa tela até o carregamento finalizar! Ao finalizar você pode retornar a tela de propostas.", "warning");
                });

                proposalForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    /*fetch(proposalForm.action, { (ta enviando duplicado o post)
                        method: proposalForm.method,
                        body: new FormData(proposalForm)
                    })
                        .then(response => {
                            console.log(response);
                            swal("Dados Salvos", "Não saia dessa tela até o carregamento finalizar!", "success");
                        })
                        .then(response => {
                            swal("Pronto!", "Preparando o download... Aguarde.", "success");
                            console.log(response)
                        })
                        .catch(error => {
                            console.log(error)
                            swal("ERRO!", "Tente mais tarde, se persistir o problema, relate a empresa.", "error");
                        });*/
                });
            </script>
    </body>

    </html>